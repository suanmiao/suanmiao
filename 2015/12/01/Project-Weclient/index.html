<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Project-Weclient · 蒜白</title><meta name="description" content="Project Brief
Description: WeChat account management application (Open Source)
Platform: Android
Attribution: over 530,000 users, 130 stars and 50 forks on Github
Relating Techniques:  Java, Android Application Components, Andr"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/useso.css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="http://weibo.com/suanmiao" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="https://github.com/suanmiao" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Project-Weclient</h1><div class="post-meta"><div class="post-time">Dec 1, 2015</div></div><div class="post-content"><h4 id="Project_Brief">Project Brief</h4><ul>
<li><strong>Description:</strong> WeChat account management application (Open Source)</li>
<li><strong>Platform:</strong> Android</li>
<li><strong>Attribution:</strong> over <strong>530,000 users</strong>, <strong>130 stars and 50 forks on Github</strong></li>
<li><strong>Relating Techniques:</strong>  Java, <a href="http://developer.android.com/guide/components/fundamentals.html" target="_blank" rel="external">Android Application Components</a>, <a href="http://developer.android.com/design/patterns/widgets.html" target="_blank" rel="external">Android Widgets</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction" target="_blank" rel="external">HTML DOM</a>,  <a href="https://en.wikipedia.org/wiki/HTTP_cookie" target="_blank" rel="external">HTTP Cookie</a>, Regex</li>
<li><strong>Duration: </strong> 2013.11 - 2015.5</li>
<li><strong>Team member:</strong> Hongkun Leng(Developer), Hong Xiao(Product Designer), Bin Fan(Product Designer) </li>
</ul>
<a id="more"></a>
<h4 id="Background:">Background:</h4><p>Originally(before May 2015), there was no official mobile application for WeChat account management, the only approach was official website, which only worked properly on desktop. However, most frequently behavior, message view and reply, happens randomly. So there was a high demand for account management features on mobile devices.</p>
<p>Webpage for Wechat official account management</p>
<p><img src="/img/weclient/Before_login.png" alt="Alt text"></p>
<h4 id="Process">Process</h4><h5 id="1-Developed_login_simulating_framework">1.Developed login simulating framework</h5><p> In order to implement management features on mobile, we had to get necessary data for each operation, while there was no official API for us to execute such operation. So the only way was simulating HTTP request as it was on the webpage.</p>
<p>  For every HTTP request, there were some fundamental elements we had to know:</p>
<ul>
<li>Target server URL</li>
<li>Request Method(POST, GET, DELETE)</li>
<li>Method Parameters</li>
<li>Necessary Header parameters</li>
</ul>
<p>To get these elements, I used Chrome Developer Console, a perfect tool for web developer, on which we could get intercept and analyze elements for each HTTP requests<br><img src="/img/weclient/General Info.png" alt="Alt text"></p>
<p>There were some basic techniques relating to simulating requests</p>
<ul>
<li>MD5 encryption (official encryption for password transmission and storage is MD5, a widely used encryption)</li>
<li>Cookie management, parse Cookie, store Cookie, read Cookie</li>
</ul>
<p>After simulating necessary requests, we could get the same HTML code as webpage version. Then, we had to parse HTML structure of the result and get what we need.<br>For example:<br>  <img src="/img/weclient/Result.png" alt="Alt text"></p>
<h5 id="2-Developed_Message_magement_function">2.Developed Message magement function</h5><p>After simulating necessary functions, the second step was to implement features. The most frequently used feature for Wechat account owners was message management. Due to the random distribution of fans(people who followed this account), message were received randomly, so account users have to wait in front of their desktop if there was no mobile application.  </p>
<p>After simulating functions,  the message data we got:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">"msg_item"</span>:[&#123;<span class="string">"id"</span>:<span class="number">401082279</span>,<span class="string">"type"</span>:<span class="number">2</span>,<span class="string">"fakeid"</span>:<span class="string">"355421075"</span>,<span class="string">"nick_name"</span>:<span class="string">"蒜苗白菜"</span>,<span class="string">"date_time"</span>:<span class="number">1449148933</span>,<span class="string">"source"</span>:<span class="string">""</span>,<span class="string">"msg_status"</span>:<span class="number">0</span>,<span class="string">"has_reply"</span>:<span class="number">0</span>,<span class="string">"refuse_reason"</span>:<span class="string">""</span>,<span class="string">"multi_item"</span>:[],<span class="string">"to_uin"</span>:<span class="number">2390625095</span>&#125;,</span><br><span class="line">&#123;<span class="string">"id"</span>:<span class="number">401082278</span>,<span class="string">"type"</span>:<span class="number">2</span>,<span class="string">"fakeid"</span>:<span class="string">"355421075"</span>,<span class="string">"nick_name"</span>:<span class="string">"蒜苗白菜"</span>,<span class="string">"date_time"</span>:<span class="number">1449148925</span>,<span class="string">"source"</span>:<span class="string">""</span>,<span class="string">"msg_status"</span>:<span class="number">0</span>,<span class="string">"has_reply"</span>:<span class="number">0</span>,<span class="string">"refuse_reason"</span>:<span class="string">""</span>,<span class="string">"multi_item"</span>:[],<span class="string">"to_uin"</span>:<span class="number">2390625095</span>&#125;,</span><br><span class="line">&#123;<span class="string">"id"</span>:<span class="number">401082277</span>,<span class="string">"type"</span>:<span class="number">1</span>,<span class="string">"fakeid"</span>:<span class="string">"355421075"</span>,<span class="string">"nick_name"</span>:<span class="string">"蒜苗白菜"</span>,<span class="string">"date_time"</span>:<span class="number">1449148906</span>,<span class="string">"content"</span>:<span class="string">"Test message two "</span>,<span class="string">"source"</span>:<span class="string">""</span>,<span class="string">"msg_status"</span>:<span class="number">0</span>,<span class="string">"has_reply"</span>:<span class="number">0</span>,<span class="string">"refuse_reason"</span>:<span class="string">""</span>,<span class="string">"multi_item"</span>:[],<span class="string">"to_uin"</span>:<span class="number">2390625095</span>&#125;,</span><br><span class="line">&#123;<span class="string">"id"</span>:<span class="number">401082275</span>,<span class="string">"type"</span>:<span class="number">1</span>,<span class="string">"fakeid"</span>:<span class="string">"355421075"</span>,<span class="string">"nick_name"</span>:<span class="string">"蒜苗白菜"</span>,<span class="string">"date_time"</span>:<span class="number">1449148900</span>,<span class="string">"content"</span>:<span class="string">"Test message one "</span>,<span class="string">"source"</span>:<span class="string">""</span>,<span class="string">"msg_status"</span>:<span class="number">0</span>,<span class="string">"has_reply"</span>:<span class="number">0</span>,<span class="string">"refuse_reason"</span>:<span class="string">""</span>,<span class="string">"multi_item"</span>:[],<span class="string">"to_uin"</span>:<span class="number">2390625095</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>Obviously, this set of data was in JSON format, and we could serialize it into corresponding JSON object list.</p>
<p>There were some basic element in each “Message Object”</p>
<ul>
<li>id: the unique identify number for each message</li>
<li>fakeid: the id of user who send this message</li>
<li>nick_name: nick name for the sending user</li>
<li>to_uin: the id of official account to whom this message is sending</li>
<li>content: content of this message</li>
<li>date_time: time when this message was created</li>
</ul>
<p>After analyse, we found some relating features and their HTTP request URL</p>
<ul>
<li><strong>get message</strong>:    <a href="https://mp.weixin.qq.com/cgi-bin/message" target="_blank" rel="external">https://mp.weixin.qq.com/cgi-bin/message</a></li>
<li><strong>star message</strong>:  <a href="https://mp.weixin.qq.com/cgi-bin/setstarmessage" target="_blank" rel="external">https://mp.weixin.qq.com/cgi-bin/setstarmessage</a></li>
<li><strong>reply message</strong>:      <a href="https://mp.weixin.qq.com/cgi-bin/singlesend" target="_blank" rel="external">https://mp.weixin.qq.com/cgi-bin/singlesend</a></li>
</ul>
<p>Finally, we implemented these features on mobile with user-friendly user interface</p>
<p>Relating techniques</p>
<ul>
<li>ListView, ViewPager Widget </li>
<li>MVVM software architectural pattern</li>
<li>Media Player component</li>
</ul>
<p><img src="/img/weclient/message_list_1.jpeg" alt="Alt text"></p>
<p>For better user experience, We even developed an one-to-one chat page for each conversation</p>
<p><img src="/img/weclient/message_chat.jpeg" alt="Alt text"></p>
<h5 id="3-Developed_Fans_management_function">3.Developed Fans management function</h5><p>In the same way, we parsed and clipped result for fans list</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">groupsList : (&#123;<span class="string">"groups"</span>:[&#123;<span class="string">"id"</span>:<span class="number">0</span>,<span class="string">"name"</span>:<span class="string">"未分组"</span>,<span class="string">"cnt"</span>:<span class="number">9</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">1</span>,<span class="string">"name"</span>:<span class="string">"黑名单"</span>,<span class="string">"cnt"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">2</span>,<span class="string">"name"</span>:<span class="string">"星标组"</span>,<span class="string">"cnt"</span>:<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="string">"id"</span>:<span class="number">101</span>,<span class="string">"name"</span>:<span class="string">"safsdaf"</span>,<span class="string">"cnt"</span>:<span class="number">0</span>&#125;]&#125;).groups,</span><br><span class="line">                        friendsList : (&#123;<span class="string">"contacts"</span>:[&#123;<span class="string">"id"</span>:<span class="number">3040136284</span>,<span class="string">"nick_name"</span>:<span class="string">"Yun"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">3179091161</span>,<span class="string">"nick_name"</span>:<span class="string">"未必美好"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">1281585781</span>,<span class="string">"nick_name"</span>:<span class="string">"Chensq"</span>,<span class="string">"remark_name"</span>:<span class="string">"陈水强"</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">1211335984</span>,<span class="string">"nick_name"</span>:<span class="string">"侦探们的镇魂歌"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">2</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">1175038025</span>,<span class="string">"nick_name"</span>:<span class="string">"李恒"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">2149997763</span>,<span class="string">"nick_name"</span>:<span class="string">"阿宽"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">791213410</span>,<span class="string">"nick_name"</span>:<span class="string">"为你喝采"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">2088220861</span>,<span class="string">"nick_name"</span>:<span class="string">"相信自己"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">355421075</span>,<span class="string">"nick_name"</span>:<span class="string">"蒜苗白菜"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;,&#123;<span class="string">"id"</span>:<span class="number">517884615</span>,<span class="string">"nick_name"</span>:<span class="string">"小宏"</span>,<span class="string">"remark_name"</span>:<span class="string">""</span>,<span class="string">"group_id"</span>:<span class="number">0</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>Then we displayed these data in an user-friendly UI</p>
<p>Relating technique:</p>
<ul>
<li>Dialog component</li>
<li>Popup Window component</li>
<li>Bitmap decoding</li>
<li>Fast cache </li>
</ul>
<p><img src="/img/weclient/fans_list.jpeg" alt="Alt text"></p>
<p>Fans profile editing feature:</p>
<p><img src="/img/weclient/edit_fans.jpeg" alt="Alt text"></p>
<p>Fans alias editing feature:</p>
<p><img src="/img/weclient/edit_fans_alias.jpeg" alt="Alt text"></p>
<h5 id="4-Notification_function">4.Notification function</h5><p>Taking full advantage of mobile platform, we used Notification API on Android system to alert users when there was new message while the app is running on background.</p>
<p>Relating technique:</p>
<ul>
<li>Notification API</li>
<li>Service component</li>
<li>Activity task mode</li>
</ul>
<h5 id="5-Open_Source">5.Open Source</h5><p>Although this was a fully functional application, it was still unofficial, we gained no support or authority from Wechat Platform, and we were only students whose credibility are limited. So, in order to show our honesty and enhance our credibility, we decided to publish our source code onto Github. The project page link: <a href="https://github.com/suanmiao/weclient" target="_blank" rel="external">https://github.com/suanmiao/weclient</a></p>
<blockquote>
<p>By now, without any promotion and advertisement, this opensource project has been starred by 130 developers and forked by 50 developers.  </p>
</blockquote>
<p>Really exciting and inspiring was this experience. It’s the first time that I fully take part in opensource community and firmly feel the super magic power of community, the influence of individuals can be amplified by the opensource community. </p>
<h4 id="Contribution">Contribution</h4><p>Without doubt, our app, as the first mobile app for account management, free account managers from desktop and they can  reply, edit message at any time. Besides that, we were also among rare developers who can release their project as opensource and be open to any advice and feedback. Consequently, we get 130 stars half a year after our release on Github. </p>
<h4 id="Milestone:">Milestone:</h4><ul>
<li>2013.12 —— Open Source project published</li>
<li>2013.12 —— First public beta version released (although there were some usability problems, we were consistently working on it)</li>
<li>2014.01 —— 500 users. This time we add feedback feature on app, and the first feedback from users was praise!</li>
<li>2014.06 —— 50 stars on Github</li>
<li>2014.07 —— 1500 users</li>
<li>2014.06 —— 100 stars on Github</li>
<li>2014.11 —— 10000 users. I can never imagine we could get such a large user base.</li>
<li>2013.03 —— 50000 users. Another surprise and inspire!</li>
</ul>
<h4 id="Tool_Used:">Tool Used:</h4><ul>
<li>Design: Photoshop</li>
<li>Request Analysis: Chrome Developer Console, Python “request” library</li>
<li>Programming: Eclipse, AndroidStudio</li>
<li>Performance Optimisation: MAT plugin(Eclipse), Android Device Monitor plugin(Eclipse)</li>
</ul>
<h3 id="Relating_Links:">Relating Links:</h3><p><a href="http://www.wandoujia.com/apps/com.suan.weclient" target="_blank" rel="external">SnapPea App Market(Wandoujia)</a> , <a href="http://shouji.baidu.com/soft/item?docid=6014819&amp;from=as&amp;f=search_app_%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%40list_1_title%401%40header_all_input" target="_blank" rel="external">Baidu App market</a><br><a href="https://github.com/suanmiao/weclient" target="_blank" rel="external">Open Source project on Github</a>  </p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/12/09/Project-Fun/" class="prev">上一篇</a><a href="/2015/11/11/Project-eTrain/" class="next">下一篇</a></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-71082558-1",'auto');ga('send','pageview');</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>